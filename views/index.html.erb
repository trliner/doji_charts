<%
  H_LINES = 5

  def y_min_and_max(data)
    data_low = data.collect {|d| d[1][0]}.sort.first
    data_high = data.collect {|d| d[1][4]}.sort.last
    data_range = data_high - data_low

    chart_range = (data_range * 1.5 / (H_LINES + 1) / 0.25).ceil * 0.25 * H_LINES
    chart_padding = (chart_range - data_range) / 2
    y_min = ((data_low - chart_padding) / 0.25).round * 0.25
    y_max = y_min + chart_range
    [y_min, y_max]
  end

  x_max = @data.count + 1
  y_min, y_max = y_min_and_max(@data)
%>
<canvas id="dojiCanvas" width="800" height="600">[No canvas support]</canvas>

<script>
    window.onload = function () {
      dojiChart = new RGraph.Scatter('dojiCanvas', <%= @data.to_json %>);

      dojiChart.Set('chart.title', <%= @chart_title.to_json %>);
      dojiChart.Set('chart.labels', <%= @labels.to_json %>);

      dojiChart.Set('chart.gutter', 45);
      dojiChart.Set('chart.background.grid.autofit', true);
      dojiChart.Set('chart.boxplot.width', 15);
      dojiChart.Set('chart.scale.decimals', 2);
      dojiChart.Set('chart.text.angle', 45);
      dojiChart.Set('chart.crosshairs', true);

      dojiChart.Set('chart.xmax', <%= x_max %>);
      dojiChart.Set('chart.background.grid.autofit.numvlines', <%= x_max %>);
      dojiChart.Set('chart.xticks', false);

      dojiChart.Set('chart.ymax', <%= y_max %>);
      dojiChart.Set('chart.ymin', <%= y_min %>);
      dojiChart.Set('chart.background.grid.autofit.numhlines', <%= H_LINES %>);

      dojiChart.Draw();
    }
</script>